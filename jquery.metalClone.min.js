!function(e){e.fn.metalClone=function(t,n){function r(t,n,r,i){var s,l=n;if(t=0==t?1:t,"after"===i){if(-1!==e.inArray(v,B)&&-1!==e.inArray(T,B))for(var f=0;t>f;f++){if(s=p())return;var u=l.clone();u.insertAfter(r.find("tr").last()),u.find("td").last().append('<div class="operations"><img src="'+c()+'/images/delete.png" class="metalBtnRemove operationsImg"/> '+g+"</div>"),d||a(u)}else if(-1!==e.inArray(v,B)&&-1==e.inArray(T,B))for(var f=0;t>f;f++){if(s=p())return;var u=l.clone();r.append(u.append('<input type="button" value="'+g+'" class="metalBtnRemove">')),d||a(u)}else if(-1==e.inArray(v,B)&&-1==e.inArray(T,B))for(var f=0;t>f;f++){if(s=p())return;var u=l.clone();r.append(u.append('<input type="button" value="'+g+'" class="metalBtnRemove">')),d||a(u)}else if(-1==e.inArray(v,B)&&-1!==e.inArray(T,B))for(var f=0;t>f;f++){if(s=p())return;var u=l.clone();r.append(u.append('<input type="button" value="'+g+'" class="metalBtnRemove">')),d||a(u)}}else if("before"===i)if(-1!==e.inArray(v,B)&&-1!==e.inArray(T,B))for(var f=0;t>f;f++){if(s=p())return;var u=l.clone();u.insertAfter(r.find("tr").first()),u.find("td").last().append('<div class="operations"><img src="'+c()+'/images/delete.png" class="metalBtnRemove operationsImg"/> '+g+"</div>"),d||a(u)}else if(-1!==e.inArray(v,B)&&-1==e.inArray(T,B))for(var f=0;t>f;f++){if(s=p())return;var u=l.clone();r.prepend(u.append('<input type="button" value="'+g+'" class="metalBtnRemove">')),d||a(u)}else if(-1==e.inArray(v,B)&&-1==e.inArray(T,B))for(var f=0;t>f;f++){if(s=p())return;var u=l.clone();r.prepend(u.append('<input type="button" value="'+g+'" class="metalBtnRemove">')),d||a(u)}else if(-1==e.inArray(v,B)&&-1!==e.inArray(T,B))for(var f=0;t>f;f++){if(s=p())return;var u=l.clone();r.prepend(u.append('<input type="button" value="'+g+'" class="metalBtnRemove">')),d||a(u)}e.isArray(h)&&e.isEmptyObject(h)||e.isArray(h)&&!e.isEmptyObject(h)&&o(h)}function i(t,n,r,i){var s,l=n;if(t=0==t?1:t,"after"===i){if(-1!==e.inArray(v,B))for(var f=0;t>f;f++){if(s=p())return;var u=l.clone();u.insertAfter(r),u.find("td").last().append('<div class="operations"><img src="'+c()+'/images/delete.png" class="metalBtnRemove operationsImg"/> '+g+"</div>"),d||a(u)}if(-1==e.inArray(v,B))for(var f=0;t>f;f++){if(s=p())return;var u=l.clone();u.insertAfter(r).append('<input type="button" value="'+g+'" class="metalBtnRemove">'),d||a(u)}}else if("before"===i)if(-1!==e.inArray(v,B))for(var f=0;t>f;f++){if(s=p())return;var u=l.clone();u.insertBefore(r),u.find("td").last().append('<div class="operations"><img src="'+c()+'/images/delete.png" class="metalBtnRemove operationsImg"/> '+g+"</div>"),d||a(u)}else for(var f=0;t>f;f++){if(s=p())return;var u=l.clone();u.insertBefore(r).append('<input type="button" value="'+g+'" class="metalBtnRemove">'),d||a(u)}e.isArray(h)&&e.isEmptyObject(h)||e.isArray(h)&&!e.isEmptyObject(h)&&o(h)}function a(t){t.find('input:not("input[type=button], input[type=submit]"), textarea, select').each(function(){e(this).val("")})}function o(t){var n;n=e.inArray("*",t)?"*":t.join(","),e(u).each(function(t,r){e(this).find(n).each(function(n,r){if(e(this).attr("id")){var i=e(this).attr("id"),a=i.replace(/\d+/g,"");e(this).attr("id",a+parseInt(t))}})})}function s(){var t;return t=R?e(u).length:e('[id="'+m[0].id+'"').length,"infinity"!=C&&"number"==typeof C?A>C?!1:t:"no limit"}function l(){var e;return e=R?u.replace(".",""):u.replace("#","")}function p(){var t,n=s(),r=!1;if(n?t="no limit"==n?0:n:(console.log("Number to clone more than limit"),r=!0),t>C){if(console.log("Can't clone more than limit provided"),e(E).next().is("span"))e(E).next().html("Clone limit reached");else{var i=l();e("<span/>",{"data-clone-reference":i,"class":"error_limit",text:"Clone limit reached"}).insertAfter(E)}r=!0}return r}opt=e.extend({},e.fn.metalClone.defaults,t);var f,c=function(){var e=document.getElementsByTagName("SCRIPT"),t="";if(e&&e.length>0)for(var n in e)if(e[n].src&&e[n].src.match(/\/jquery.metalClone\.js$/)){t=e[n].src.replace(/(.*)\/jquery.metalClone\.js$/,"$1");break}return t},u=this.selector,m=this,v=this[0].nodeName,d=opt.copyValue,y=opt.position,A=opt.numberToClone,b=opt.destination,h=opt.ids,g=opt.btnRemoveText,T=b?e(b)[0].nodeName:"none",C=opt.cloneLimit,B=["TABLE","TR","TD","TBODY","TFOOT","THEAD","TH"],R=!1;u.match(/[.]/)?(R=!0,f=e(this).first()):f=e(this);var x,j;-1!==e.inArray(v,B)&&(x=f.closest("table"),j=x.find("tr").first());var E;return null===opt.btnClone?(E="metalBtnClone"+Math.floor(9*Math.random()+1),-1!==e.inArray(v,B)&&-1==e.inArray(T,B)?e("<input/>",{type:"button",value:opt.btnCloneText,"class":E,css:{marginTop:"10px"}}).insertAfter(x):-1!==e.inArray(v,B)&&-1!==e.inArray(T,B)?e("<input/>",{type:"button",value:opt.btnCloneText,"class":E,css:{marginTop:"10px"}}).insertAfter(x):-1==e.inArray(v,B)&&-1==e.inArray(T,B)?e("<input/>",{type:"button",value:opt.btnCloneText,"class":E,css:{marginTop:"10px"}}).insertAfter(u):-1==e.inArray(v,B)&&-1!==e.inArray(T,B)&&e("<input/>",{type:"button",value:opt.btnCloneText,"class":E,css:{marginTop:"10px"}}).insertAfter(u),E="."+E):E=opt.btnClone,e(document).on({mouseenter:function(){e(this).find(".operations").css({display:"block"})},mouseleave:function(){e(this).find(".operations").css({display:"none"})}},u),e(document).on("click",E,function(){var t;return b!==!1?(t=e(b),"after"===y?void r(A,f,t,y):void r(A,f,t,y)):(t=e(u),"after"===y?void i(A,f,t.last(),y):void i(A,f,t.first(),y))}),e(document).on("click",".metalBtnRemove",function(){var t=l();e(this).closest(u).remove(),e("body").find('[data-clone-reference="'+t+'"]').remove()}),f.each(function(t,n){e(this)})},e.fn.metalClone.defaults={destination:!1,position:"after",numberToClone:1,ids:[],btnClone:null,copyValue:!1,btnRemoveText:"Remove me",btnCloneText:"Create New Element",cloneLimit:"infinity"}}(jQuery);